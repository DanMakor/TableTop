for (var i = 0; i < players.length; i++) {
  if (players[i].opponent == null)
    return;
  else {
    var s = 0;
    for (s = ; s < players.length - s; s ++) {
      //Check if higher player has ever played lower player
      var opponents = player[i].getAllOpponents(); 
      var hasPlayed = false;
      foreach (opponents as opponent) {
        if (player[s] == opponent) { hasPlayed = true; }
      }
      //If they have not played allocate them as opponents
      if (hasPlayed == false) {
        player[i].opponent = player[s];
        player[s].opponent = player[i];
      }
      //If there was no one to allocate, de allocate next highest player
      if (s == (players.length - s) - 1 && (player[i].opponent == null) {
        if (i - 1 >= 0) {
          if (player[i - 1].opponent.position < player[i].position) {
            s = i + 1;
          } else {
            s = player[i - 1].opponent.position + 1;
          }
          player[i - 1].opponent.opponent = null;
          player[i - 1].opponent = null;          
        }
      }
    }
  }
}
